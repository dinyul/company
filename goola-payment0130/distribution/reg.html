<!doctype html>
<html lang="en">
	<head>
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10" />
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-store">
		<meta name="format-detection" content="telephone=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="/distribution/fStatic/mui/css/mui.min.css?t=20161117" type="text/css" rel="stylesheet" />
		<link href="/distribution/fStatic/mui/css_my/app.css?t=20161117" type="text/css" rel="stylesheet" />
		<script src="/distribution/fStatic/mui/js/mui.min.js?t=20161117" type="text/javascript"></script>
		<link href="/distribution/static/jquery-validation/1.11.0/jquery.validate.min.css?t=20161117" type="text/css" rel="stylesheet" />
		<script src="/distribution/static/jquery/jquery-1.8.3.min.js?t=20161117" type="text/javascript"></script>
		<script src="/distribution/static/jquery-validation/1.11.0/jquery.validate.min.js?t=20161117" type="text/javascript"></script>
		<script type="text/javascript" src="/lib/doT/1.0.3/doT.min.js?t=20161117"></script>
		<script type="text/javascript" src="/lib/flexible.js"></script>
		<script type="text/javascript" src="/js/goola.js?t=20161117" ></script>
		<script type="text/javascript" src="/js/goola.api.js?t=20161117" ></script>
		<script type="text/javascript" src="/js/goola.util.js?t=20161117" ></script>
		<script type="text/javascript" src="/js/goola.ajax.js?t=20161117" ></script>
		<link href="/css/base.css" type="text/css" rel="stylesheet"/>
		<title>事业合伙人注册</title>
		<meta charset="utf-8" />
		<style>
			.mui-input-group:before
			{
				position: relative
			}
			.mui-input-group:after
			{
				position: relative
			}
			.mui-input-group
			{
				position: inherit;
				margin-top: 2px;
			}
			.margin-line
			{
				margin-top: 12px;
			}
			.mui-input-group .mui-input-row:after
			{
				position: relative;
			}
			.mui-input-group .mui-input-row
			{
				border-bottom: 1px solid #eee;
				margin: 0px 20px 0px 20px;
				padding: 10px 0px;
				height: 50px;
			}
			
			.mui-input-group input
			{
				margin-top: -30px;
				padding-left: 50px;
				padding-right: 30px;
				display: block;
			}
			
			.mui-btn-orange
			{
				color: #fff;
	            border: 1px solid #fa2f3e;
		    	background-color: #fa2f3e;
		    	margin-top: 30px;
		    	padding: 10px 0px;
			}
			
			.mui-input-row i~input.button {
				padding-right: 120px;
			}
			
			.mui-input-row .mui-btn.width {
				margin-top: -40px;
				width: 115px;
				border-radius: 0px;
				border-width: 0px;
				border-left: 2px solid #fa2f3e;
				color: #fa2f3e;
			}
		</style>
	</head>
	<body style="display:none">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">事业合伙人注册</h1>
		</header>
		<form class="mui-content">
			<div class="mui-input-group">
				<div class="mui-input-row">
					<i class="user-reg-pic user-reg-mobile user-reg-backgroundsize"></i>
					<input id='mobile' name='mobile' type="text" class="mui-input-clear mui-input"
						 placeholder="请输入手机号" alt="手机号" >
				</div>
				<div class="mui-input-row">
					<i class="user-reg-pic user-reg-validate-code user-reg-backgroundsize"></i>
					<input id='mobileCaptcha' name='mobileCaptcha' type="text" class="mui-input button required"
						 placeholder="请输入验证码" alt="验证码" >
					<button type="button" class="mui-btn width" id="getMobileCatpthca">
						获取验证码
					</button>
				</div>
				
			</div>
			<div class="mui-input-group margin-line">
				<div class="mui-input-row" style="display: none;">
					<B><p style="color:#fa2f3e">非必填项</p></B>
				</div>
				<div class="mui-input-row">
					<i class="user-reg-pic user-reg-expend user-reg-backgroundsize"></i>
					<input id='expandCode' name='expandCode' type="text" class="mui-input-clear mui-input required"
						 placeholder="推广号" alt="推广号" >
				</div>
				<!--<div class="mui-input-row">
					<i class="user-reg-pic user-reg-reason user-reg-backgroundsize"></i>
					<input id='applicationReason' name='applicationReason' type="text" class="mui-input-clear mui-input"
						 placeholder="申请原因" alt="申请原因" maxlength="100">
				</div>-->
			</div>
		</form>
		<div class="mui-content-padded">
			<button id='login' class="mui-btn mui-btn-block mui-btn-orange" >下一步</button>
		</div>
		<script type="text/javascript">
		(function(api, util, ajax){
			var countdown=60; 
			function settime(dom) { 
				if (countdown == 0) { 
					dom.removeAttr("disabled") 
					dom.html("获取验证码");
					dom.css('border-left','1px solid #fa2f3e')
							.css('color','#fa2f3e') 
					countdown = 60; 
					return;
				} else { 
					dom.attr("disabled", true) 
					dom.html(countdown+"s后重新发送"); 
					countdown--; 
					} 
				setTimeout(function() { 
					settime(dom) 
				},1000) 
			} 
			
			
			//处理分销推广码
			var expandRegCode = getUrlParam('expandCode');
			var type=getUrlParam('type')
			if(expandRegCode != null && expandRegCode != '' && expandRegCode != 'null'){
				 $("#expandCode").val(expandRegCode);
				 $("#expandCode").attr("disabled","disabled");
			}else{
				$("#expandCode").val("");
			}
			
			//表单验证标示
			var captchaFlag = false;//验证码标示
			var expandCodeFlag = true;//推广码标示
			//获取验证码
			function getCaptcha(){
				var mobile = "";
				if (document.getElementById("mobile").parentElement.style.display != 'none') {
					mobile = document.getElementById("mobile").value;
					//验证手机号
					if(!/^(13[0-9]|17[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(mobile)){
						mui.alert('手机格式不正确，请重新输入');
						document.getElementById("mobile").style.color = "red";
						return;
					}
				}
				ajax.post(api.baseServerUrl + "/reg/getCaptcha",{
					mobile:mobile
				},function(data) {
					mui.alert("发送成功");
					settime($('#getMobileCatpthca'))
				},function(returnData){
					mui.alert(returnData.message);
				});
				
			}
			
			regRedirect();
			function regRedirect(){
				ajax.post(api.baseServerUrl + "/reg/regRedirect",{
					type:type
				},function(data) {
					document.body.style.display="";
					var url = "./userCenter.html"
					if ("index" == data) {
						url = "../index.html";
					} else if ("userCenter" == data) {
						url = "./userCenter.html"
					} else if ("introduce" == data && type!=2) {
						url = "./introduce.html"
					} else if ("introduceExist" == data && type!=2) {
						url = "./introduce.html"
					} else if ("introduce" == data && type==2) {
						document.body.style.display="";
						return false
					} else if ("introduceExist" == data && type==2) {
						document.body.style.display="";
						document.getElementById("mobile").parentElement.style.display = "none";
						return false
					} else if(data==""||data==undefined||data==null){
						url = "./reg-success.html";  
					}
					window.location.href = url;
				},function(returnData){
					document.body.style.display="";
					if (returnData.data) {
						document.getElementById("mobile").parentElement.style.display = "none";
					}
				});
			}
			
			$("#getMobileCatpthca").click(function(){
				getCaptcha();
			})

			//验证===验证码===是否合法
			function validateCaptcha(captcha){
				if(captcha.trim()==""){
					return;
				}
				//验证密码是否合法
				if(!/^[0-9]{6}$/i.test(captcha)){
					mui.alert('请输入6位数字');
					captchaFlag = false;
					return;
				}
				captchaFlag = true;
			}
			
			$("#mobileCaptcha").blur(function() {
				validateCaptcha($(this).val());
			})
			
			$("#expendCode").blur(function() {
				validateExpandCode($(this).val());
			})
			
			function submitForm() {
				var loopFlag = true;
				mui(".mui-input-group .required").each(function () {
					//若当前input为空，则alert提醒  
					if(!this.value||this.value.trim()==""){ 
						mui.alert(this.alt+"不允许为空");     
						loopFlag = false;
						return false;   
					} 
				});
				var mobile = "";
				if (document.getElementById("mobile").parentElement.style.display != 'none') {
					mobile = document.getElementById("mobile").value;
					//验证手机号
					if(!/^(13[0-9]|17[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(mobile)){
						mui.alert('手机格式不正确，请重新输入');
						document.getElementById("mobile").style.color = "red";
						return;
					}
				}
				if(!loopFlag){
					return;
				}
				if(expandCodeFlag && captchaFlag){
					var url = api.baseServerUrl + '/reg/finishReg/';
					var captcha = document.getElementById("mobileCaptcha").value;
					var expandCode = document.getElementById("expandCode").value;
					//var applicationReason = document.getElementById("applicationReason").value;
					ajax.post(url,{
						mobile:mobile,
						captcha:captcha,
						expandCode:expandCode
					},function(data) {
					    var url = "./userCenter.html"
						if ("index" == data) {
							url = "./userCenter.html";
						} else if ("userCenter" == data) {
							url = "./userCenter.html"
						} else {
							url = "./reg-success.html";   
						}
						window.location.href = url;
					},function(returnData){
						mui.alert(returnData.message);
					});
				}else{
					mui.alert("表单信息有误，请重新检查");
					return false;
				}
			}
			$("#login").click(function(){
				submitForm();
			})
			//原生js手写trim方法
			String.prototype.trim = function(){
				return this.replace(/^\s+/, "").replace(/\s+$/, "");
			}
		})(goola.api, goola.util, goola.ajax)
		
		function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
		</script>
	</body>
</html>